<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Get Sum</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <script>

    var hungryFoxes = function(farm) {
        var outside = [];
        var territory = farm;
        while (territory.includes('[')) {
            //console.log("remaining string:" + territory, "outside:" + outside);
            var field = territory.substring(0,territory.indexOf('['));
            outside.push(field);
            territory = territory.substring(territory.indexOf(']')+1, territory.length);
        }
        outside.push(territory);

        var foxesOutside = false;
        //console.log("outside:" + outside);
        
        outside.forEach(function(element) {
            for (var n=0; n<element.length; n++) {
                if (element[n]==='F') {
                    foxesOutside = true;
                }
            }
            //console.log(foxesOutside);
        });
        var answer = "";
        var i = 0;
        while (i<farm.length) {
            if (farm[i]=="[") {
                var temp = farm.substring(i);
                var henhouse = temp.substring(0, temp.indexOf(']')+1);
                if (henhouse.includes("F")) {
                    for (var j = 0; j<henhouse.length; j++) {
                        if (henhouse[j]==='C') {
                            answer = answer + '.';
                        }
                        else {
                            answer = answer + henhouse[j];
                        }
                    }
                }
                else {
                    answer = answer + henhouse;
                }
                i = i + henhouse.length;
            }
            else if (farm[i]==="C") {
                if (foxesOutside) {
                    answer = answer + ".";
                    i++;
                }
                else {
                    answer = answer + farm[i];
                    i++;
                }
            }
            else {
                answer = answer + farm[i];
                i++;
            }
        }
        return answer;
    }

    var before = "CCC[CCC]FCC[CCCCC]CFFFF[CCC]FFFF";
    var after  = "...[CCC]F..[CCCCC].FFFF[CCC]FFFF";

    console.log(hungryFoxes(before), + "\n" + after);

   </script>

</body>

</html>